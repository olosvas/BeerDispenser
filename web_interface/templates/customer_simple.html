{% extends "layout.html" %}

{% block title %}
    {% if language == "sk" %}Zákaznícky režim (Zjednodušený){% else %}Customer Mode (Simplified){% endif %}
{% endblock %}

{% block styles %}
<style>
    .card {
        margin-bottom: 20px;
    }
    .card.selected {
        border: 3px solid #0d6efd;
        background-color: rgba(13, 110, 253, 0.1);
    }
    .selected-badge {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: #0d6efd;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <div class="alert alert-info">
                <h4>{% if language == "sk" %}Zjednodušený režim{% else %}Simplified Mode{% endif %}</h4>
                <p>{% if language == "sk" %}Tento režim obsahuje zjednodušené rozhranie pre testovanie{% else %}This mode includes a simplified interface for testing{% endif %}</p>
            </div>
        </div>
    </div>

    <!-- Beverage Selection (STEP 1) -->
    <div id="step1" class="card">
        <div class="card-header bg-primary text-white">
            <h5>{% if language == "sk" %}Krok 1: Vyberte nápoj{% else %}Step 1: Select Beverage{% endif %}</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div id="beer-card" class="card h-100 beverage-option" data-type="beer" onclick="selectBeverage('beer', this)">
                        <div class="card-body text-center">
                            <i class="fas fa-beer fa-3x text-primary mb-3"></i>
                            <h5>{% if language == "sk" %}Pivo{% else %}Beer{% endif %}</h5>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div id="kofola-card" class="card h-100 beverage-option" data-type="kofola" onclick="selectBeverage('kofola', this)">
                        <div class="card-body text-center">
                            <i class="fas fa-wine-bottle fa-3x text-dark mb-3"></i>
                            <h5>Kofola</h5>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div id="birel-card" class="card h-100 beverage-option" data-type="birel" onclick="selectBeverage('birel', this)">
                        <div class="card-body text-center">
                            <i class="fas fa-beer fa-3x text-warning mb-3"></i>
                            <h5>Birel</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Size Selection (STEP 2) -->
    <div id="step2" class="card">
        <div class="card-header bg-primary text-white">
            <h5>{% if language == "sk" %}Krok 2: Vyberte veľkosť{% else %}Step 2: Select Size{% endif %}</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div id="small-card" class="card h-100 size-option" data-size="300" onclick="selectSize(300, this)">
                        <div class="card-body text-center">
                            <i class="fas fa-glass-whiskey fa-3x text-primary mb-3"></i>
                            <h5>{% if language == "sk" %}Malé (300ml){% else %}Small (300ml){% endif %}</h5>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div id="large-card" class="card h-100 size-option" data-size="500" onclick="selectSize(500, this)">
                        <div class="card-body text-center">
                            <i class="fas fa-beer fa-3x text-primary mb-3"></i>
                            <h5>{% if language == "sk" %}Veľké (500ml){% else %}Large (500ml){% endif %}</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quantity Selection (STEP 3) -->
    <div id="step3" class="card">
        <div class="card-header bg-primary text-white">
            <h5>{% if language == "sk" %}Krok 3: Vyberte množstvo{% else %}Step 3: Select Quantity{% endif %}</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 offset-md-3">
                    <div class="input-group mb-3">
                        <button class="btn btn-outline-secondary" type="button" onclick="decreaseQuantity()">-</button>
                        <input type="text" id="quantity-input" class="form-control text-center" value="1" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="increaseQuantity()">+</button>
                    </div>
                    <div class="btn-group w-100 mb-3">
                        <button class="btn btn-outline-primary" onclick="setQuantity(1)">1</button>
                        <button class="btn btn-outline-primary" onclick="setQuantity(2)">2</button>
                        <button class="btn btn-outline-primary" onclick="setQuantity(3)">3</button>
                        <button class="btn btn-outline-primary" onclick="setQuantity(5)">5</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Actions (STEP 4) -->
    <div id="step4" class="card">
        <div class="card-header bg-primary text-white">
            <h5>{% if language == "sk" %}Krok 4: Akcie{% else %}Step 4: Actions{% endif %}</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6 offset-md-3">
                    <button id="add-to-cart-btn" class="btn btn-success btn-lg w-100 mb-3" onclick="addToCart()">
                        <i class="fas fa-cart-plus me-2"></i> {% if language == "sk" %}Pridať do košíka{% else %}Add to Cart{% endif %}
                    </button>
                    <button id="view-cart-btn" class="btn btn-primary btn-lg w-100" onclick="viewCart()">
                        <i class="fas fa-shopping-cart me-2"></i> {% if language == "sk" %}Zobraziť košík{% else %}View Cart{% endif %}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Display (STEP 5) -->
    <div id="step5" class="card d-none">
        <div class="card-header bg-primary text-white">
            <h5>{% if language == "sk" %}Košík{% else %}Cart{% endif %}</h5>
        </div>
        <div class="card-body">
            <div id="cart-items" class="mb-3">
                <!-- Cart items will be displayed here -->
                <div class="alert alert-info" id="empty-cart-message">
                    {% if language == "sk" %}Váš košík je prázdny{% else %}Your cart is empty{% endif %}
                </div>
            </div>
            <div id="cart-total" class="alert alert-primary mb-3" style="display: none;">
                <div class="d-flex justify-content-between">
                    <span>{% if language == "sk" %}Celkom{% else %}Total{% endif %}:</span>
                    <span id="total-price">€0.00</span>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-secondary btn-lg w-100" onclick="backToShopping()">
                        <i class="fas fa-arrow-left me-2"></i> {% if language == "sk" %}Späť{% else %}Back{% endif %}
                    </button>
                </div>
                <div class="col-md-6">
                    <button id="checkout-btn" class="btn btn-primary btn-lg w-100" onclick="checkout()">
                        {% if language == "sk" %}Dokončiť objednávku{% else %}Checkout{% endif %} <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Global variables
    let selectedBeverage = '';
    let selectedSize = 0;
    let currentQuantity = 1;
    let cartItems = [];
    
    // Helper functions
    function getBeverageName(type) {
        switch(type) {
            case 'beer': return document.querySelector('#beer-card h5').textContent;
            case 'kofola': return 'Kofola';
            case 'birel': return 'Birel';
            default: return type;
        }
    }
    
    function getBeveragePrice(type, size) {
        const prices = {
            beer: { '300': 2.50, '500': 3.50 },
            kofola: { '300': 1.80, '500': 2.80 },
            birel: { '300': 2.30, '500': 3.30 }
        };
        
        return prices[type] && prices[type][size] ? prices[type][size] : 0;
    }
    
    // Selection functions
    function selectBeverage(type, element) {
        console.log("Selected beverage:", type);
        selectedBeverage = type;
        
        // Clear previous selections
        document.querySelectorAll('.beverage-option').forEach(card => {
            card.classList.remove('selected');
            const badge = card.querySelector('.selected-badge');
            if (badge) badge.remove();
        });
        
        // Mark this one as selected
        element.classList.add('selected');
        
        // Add badge
        const badge = document.createElement('div');
        badge.className = 'selected-badge';
        badge.textContent = '✓ Selected';
        element.appendChild(badge);
    }
    
    function selectSize(size, element) {
        console.log("Selected size:", size);
        selectedSize = size;
        
        // Clear previous selections
        document.querySelectorAll('.size-option').forEach(card => {
            card.classList.remove('selected');
            const badge = card.querySelector('.selected-badge');
            if (badge) badge.remove();
        });
        
        // Mark this one as selected
        element.classList.add('selected');
        
        // Add badge
        const badge = document.createElement('div');
        badge.className = 'selected-badge';
        badge.textContent = '✓ Selected';
        element.appendChild(badge);
    }
    
    // Quantity functions
    function decreaseQuantity() {
        if (currentQuantity > 1) {
            currentQuantity--;
            document.getElementById('quantity-input').value = currentQuantity;
        }
    }
    
    function increaseQuantity() {
        currentQuantity++;
        document.getElementById('quantity-input').value = currentQuantity;
    }
    
    function setQuantity(quantity) {
        currentQuantity = quantity;
        document.getElementById('quantity-input').value = currentQuantity;
    }
    
    // Cart functions
    function addToCart() {
        if (!selectedBeverage || !selectedSize) {
            alert('Please select both beverage and size');
            return;
        }
        
        // Add to cart
        cartItems.push({
            beverage: selectedBeverage,
            size: selectedSize,
            quantity: currentQuantity
        });
        
        // Show success message
        alert('Added ' + currentQuantity + ' x ' + getBeverageName(selectedBeverage) + ' (' + selectedSize + 'ml) to cart');
        
        // Reset inputs
        currentQuantity = 1;
        document.getElementById('quantity-input').value = 1;
    }
    
    function viewCart() {
        // Hide regular steps
        document.querySelectorAll('#step1, #step2, #step3, #step4').forEach(step => {
            step.classList.add('d-none');
        });
        
        // Show cart
        document.getElementById('step5').classList.remove('d-none');
        
        // Update cart display
        updateCartDisplay();
    }
    
    function updateCartDisplay() {
        const cartItemsContainer = document.getElementById('cart-items');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const cartTotal = document.getElementById('cart-total');
        
        // Clear previous items
        while (cartItemsContainer.firstChild && cartItemsContainer.firstChild !== emptyCartMessage) {
            cartItemsContainer.removeChild(cartItemsContainer.firstChild);
        }
        
        if (cartItems.length === 0) {
            emptyCartMessage.style.display = 'block';
            cartTotal.style.display = 'none';
            document.getElementById('checkout-btn').disabled = true;
        } else {
            emptyCartMessage.style.display = 'none';
            cartTotal.style.display = 'block';
            document.getElementById('checkout-btn').disabled = false;
            
            let totalPrice = 0;
            
            // Add each item
            cartItems.forEach((item, index) => {
                const itemPrice = getBeveragePrice(item.beverage, item.size);
                const subtotal = itemPrice * item.quantity;
                totalPrice += subtotal;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'card mb-2';
                itemDiv.innerHTML = `
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-0">${getBeverageName(item.beverage)}</h5>
                            <small>${item.size}ml x ${item.quantity}</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="fw-bold me-3">€${subtotal.toFixed(2)}</span>
                            <button class="btn btn-sm btn-outline-danger" onclick="removeCartItem(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                cartItemsContainer.insertBefore(itemDiv, emptyCartMessage);
            });
            
            // Update total
            document.getElementById('total-price').textContent = '€' + totalPrice.toFixed(2);
        }
    }
    
    function removeCartItem(index) {
        cartItems.splice(index, 1);
        updateCartDisplay();
    }
    
    function backToShopping() {
        // Show regular steps
        document.querySelectorAll('#step1, #step2, #step3, #step4').forEach(step => {
            step.classList.remove('d-none');
        });
        
        // Hide cart
        document.getElementById('step5').classList.add('d-none');
    }
    
    function checkout() {
        const hasAlcohol = cartItems.some(item => item.beverage === 'beer');
        
        if (hasAlcohol) {
            alert('{% if language == "sk" %}Potrebné overenie veku pre alkoholické nápoje.{% else %}Age verification required for alcoholic beverages.{% endif %}');
        } else {
            alert('{% if language == "sk" %}Pokračovanie k platbe{% else %}Proceeding to payment{% endif %}');
        }
    }
</script>
{% endblock %}